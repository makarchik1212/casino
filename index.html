<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Dropnado | Кейс-казино</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #111;
      color: #fff;
    }

    header {
      background: #1c1f26;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      color: #00ffff;
      font-size: 28px;
      margin: 0;
    }

    .balance {
      font-size: 18px;
    }

    main {
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    section {
      background: #1a1d23;
      padding: 20px;
      border-radius: 12px;
    }

    h2 {
      margin-top: 0;
    }

    .case-list button {
      width: 100%;
      padding: 10px;
      background: #00ffff;
      color: #000;
      border: none;
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    .inventory-item {
      background: #252830;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .contracts {
      grid-column: span 3;
      margin-top: 20px;
    }

    #contract-list {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px 0;
    }

    .contract-item {
      padding: 10px;
      background: #252830;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      border: 2px solid transparent;
    }

    .contract-item.selected {
      border-color: #00ffff;
    }

    #make-contract {
      padding: 10px 20px;
      background: #00ffff;
      border: none;
      border-radius: 6px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }

    .upgrader {
      grid-column: span 3;
      margin-top: 20px;
      background: #20242d;
    }

    .upgrader input {
      padding: 10px;
      margin-right: 10px;
    }

    .upgrader button {
      padding: 10px 20px;
      background: #00ffff;
      border: none;
      border-radius: 6px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }

    .promo {
      grid-column: span 3;
      background: #191c22;
      margin-top: 20px;
      padding: 20px;
      border-radius: 10px;
    }

    .promo input {
      padding: 10px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Dropnado</h1>
    <div class="balance">Баланс: <span id="balance">1000</span>$</div>
  </header>

  <main class="main">
    <section class="case-list">
      <h2>Кейсы</h2>
      <button onclick="openCase('Desert Case', 100)">Desert Case – $100</button>
      <button onclick="openCase('Night Storm', 200)">Night Storm – $200</button>
      <button onclick="openCase('Ultra Rare', 500)">Ultra Rare – $500</button>
    </section>

    <section class="inventory">
      <h2>Инвентарь</h2>
      <ul id="inventory-list"></ul>
    </section>

    <section class="contracts">
      <h2>Контракты</h2>
      <p>Выберите 3–10 предметов для обмена</p>
      <ul id="contract-list"></ul>
      <button id="make-contract" disabled>Создать контракт</button>
    </section>

    <section class="upgrader">
      <h2>Апгрейд</h2>
      <input type="number" id="upgrade-id" placeholder="ID предмета из инвентаря">
      <input type="number" id="target-price" placeholder="Цена цели ($)">
      <button onclick="tryUpgrade()">Апгрейд</button>
    </section>

    <section class="promo">
      <h2>Промокод</h2>
      <input type="text" id="promo-code" placeholder="Введите промокод">
      <button onclick="redeemPromo()">Активировать</button>
    </section>
  </main>

  <script>
    let balance = 1000;
    let inventory = [];
    let usedPromo = false;

    const skins = [
      { name: "AK-47 | Redline", price: 120 },
      { name: "M4A4 | Howl", price: 300 },
      { name: "AWP | Asiimov", price: 200 },
      { name: "Glock-18 | Fade", price: 180 },
      { name: "Karambit | Doppler", price: 600 },
      { name: "USP-S | Kill Confirmed", price: 150 },
      { name: "Desert Eagle | Blaze", price: 250 }
    ];

    function updateBalance() {
      document.getElementById("balance").textContent = balance;
    }

    function updateInventory() {
      const list = document.getElementById("inventory-list");
      list.innerHTML = '';
      inventory.forEach((item, index) => {
        const el = document.createElement('li');
        el.className = 'inventory-item';
        el.textContent = `#${index} - ${item.name} – $${item.price}`;
        list.appendChild(el);
      });
    }

    function getRandomSkin() {
      return skins[Math.floor(Math.random() * skins.length)];
    }

    function openCase(caseName, casePrice) {
      if (balance < casePrice) {
        alert("Недостаточно средств!");
        return;
      }
      balance -= casePrice;
      const drop = getRandomSkin();
      inventory.push(drop);
      alert(`Открыл ${caseName} и получил: ${drop.name} – $${drop.price}`);
      updateBalance();
      updateInventory();
      updateContractList();
    }

    // Контракты
    const contractList = document.getElementById('contract-list');
    const makeContractBtn = document.getElementById('make-contract');
    let selectedForContract = [];

    function updateContractList() {
      contractList.innerHTML = '';
      inventory.forEach((item, index) => {
        const el = document.createElement('div');
        el.className = 'contract-item';
        el.textContent = `${item.name} ($${item.price})`;
        el.onclick = () => toggleContractItem(index, el);
        if (selectedForContract.includes(index)) el.classList.add('selected');
        contractList.appendChild(el);
      });
      makeContractBtn.disabled = selectedForContract.length < 3 || selectedForContract.length > 10;
    }

    function toggleContractItem(index, el) {
      if (selectedForContract.includes(index)) {
        selectedForContract = selectedForContract.filter(i => i !== index);
        el.classList.remove('selected');
      } else {
        selectedForContract.push(index);
        el.classList.add('selected');
      }
      makeContractBtn.disabled = selectedForContract.length < 3 || selectedForContract.length > 10;
    }

    makeContractBtn.addEventListener('click', () => {
      const selectedItems = selectedForContract.map(i => inventory[i]);
      const totalValue = selectedItems.reduce((sum, item) => sum + item.price, 0);
      const newItemPrice = Math.floor(totalValue * (0.8 + Math.random() * 0.4));
      const newItemName = "Контрактный дроп $" + newItemPrice;

      inventory = inventory.filter((_, idx) => !selectedForContract.includes(idx));
      inventory.push({ name: newItemName, price: newItemPrice });

      selectedForContract = [];
      updateBalance();
      updateInventory();
      updateContractList();

      alert(`Ты получил: ${newItemName}`);
    });

    // Апгрейд
    function tryUpgrade() {
      const id = parseInt(document.getElementById('upgrade-id').value);
      const target = parseInt(document.getElementById('target-price').value);
      if (isNaN(id) || isNaN(target) || !inventory[id]) return alert('Неверный ввод.');

      const current = inventory[id];
      const chance = Math.min(100, Math.floor((current.price / target) * 100));
      const success = Math.random() * 100 <= chance;

      if (success) {
        inventory[id] = { name: `Апгрейд $${target}`, price: target };
        alert(`Успешный апгрейд до $${target} (${chance}%)!`);
      } else {
        inventory.splice(id, 1);
        alert(`Провал. Ты потерял ${current.name} (${chance}%)`);
      }

      updateInventory();
      updateContractList();
    }

    // Промокод
    function redeemPromo() {
      if (usedPromo) return alert("Промокод уже активирован!");
      const code = document.getElementById('promo-code').value.trim().toLowerCase();
      if (code === "dropnado") {
        balance += 500;
        usedPromo = true;
        alert("Промокод активирован! +$500 на баланс");
        updateBalance();
      } else {
        alert("Неверный промокод!");
      }
    }

    updateBalance();
    updateInventory();
    updateContractList();
  </script>
</body>
</html>
